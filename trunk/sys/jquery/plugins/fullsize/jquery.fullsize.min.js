(function(a){a.fn.fullsize=function(b){var d={shadow:true,zoomInSpeed:200,zoomOutSpeed:200,fadeInSpeed:250,fadeOutSpeed:250,leftOffset:0,topOffset:0,iconOffset:8,forceTitleBar:false,extraTrigger:false,parentSteps:0,destroy:false,start:function(){},end:function(){},triggerIcon:true,triggerEvent:"click"};var c=a.extend(d,b);if(c.destroy==true){a("div.fullsize-icon").remove()}a(document).keydown(function(e){if(e.keyCode==27){a("div.fullsize-wrapper, div.fullsize-sh-wrap").fadeOut(c.fadeOutSpeed,function(){a(this).remove()});c.end.call(this)}});return this.each(function(){if(c.destroy==true){a(this).unbind()}else{if(a(this).attr("longdesc")){var m=a(this);var k=m.attr("title");var l=m.attr("longdesc");var n=a("<div></div>").addClass("fullsize-icon").css({display:"none"});if(c.triggerIcon){var o=n;var j=true}else{var o=a(this);var j=false}if(j){var f;if(c.extraTrigger){var g=m;for(var h=0;h<=c.parentSteps;h++){g=g.parent()}f=g.find(c.extraTrigger)}m.add(f).hover(function(){var v=m.css("marginTop").slice(0,-2);var w=m.css("marginLeft").slice(0,-2);var x=m.css("marginLeft").slice(0,-2);var s=m.css("marginLeft").slice(0,-2);if(v<0||w<0||x<0||s<0){var i=a(m);var r=a(m).parents();a(r).each(function(){if(this.tagName=="BODY"){return false}else{if(a(this).css("overflow")=="hidden"){i=a(this);return false}}});var t=i.offset();var u=parseInt(i.css("border-top-width"));var q=parseInt(i.css("border-left-width"))}else{var t=m.offset();var u=parseInt(m.css("border-top-width"));var q=parseInt(m.css("border-left-width"))}if(!u){u=0}if(!q){q=0}var p=false;a("div.fullsize-icon").each(function(){if(parseInt(a(this).css("top"))==(t.top+c.iconOffset+u)&&parseInt(a(this).css("left"))==(t.left+c.iconOffset+q)){p=true;curIcon=a(this)}});if(p==false){a(n).css({top:t.top+c.iconOffset+u,left:t.left+c.iconOffset+q});a("body").prepend(n)}a(n).show()},function(){a(n).hide()});a(n).hover(function(){a(this).show()},function(){a(this).hide()})}a(o).bind(c.triggerEvent,function(){c.start.call(this);a("div.fullsize-wrapper, div.fullsize-sh-wrap").remove();var u=a(window).width();var s=a(window).height();var p=a(window).scrollTop();var w=a(window).scrollLeft();if(!a.support.opacity&&parseInt(a.browser.version.substr(0,1))<"8"){var i=(((u-c.leftOffset)/2)+w)-25;var v=(((s-c.topOffset)/2)+p)-25}else{var i=(((u+c.leftOffset)/2)+w)-25;var v=(((s+c.topOffset)/2)+p)-25}var t=a("<div></div>").addClass("fullsize-loading").css({"margin-left":i,"margin-top":v});var q=a("<div></div>").addClass("fullsize-loading-inner");a(t).prepend(q);a("body").prepend(t);var r=new Image();a(r).load(function(){a(this).hide();var K=m.offset();img_w=this.width;img_h=this.height;aspect=img_w/img_h;if(((img_w+c.leftOffset)+32)>u){img_w=(u-c.leftOffset)-32;img_h=img_w/aspect}if(((img_h+c.topOffset)+36)>s){img_h=(s-c.topOffset)-36;img_w=img_h*aspect}if(!a.support.opacity&&parseInt(a.browser.version.substr(0,1))<"8"){var B=Math.round((((u-c.leftOffset)-img_w)/2)+w);var C=Math.round((((s-c.topOffset)-img_h)/2)+p)}else{var B=Math.round((((u+c.leftOffset)-img_w)/2)+w);var C=Math.round((((s+c.topOffset)-img_h)/2)+p)}if(B<0){B=0}if(C<0){C=0}a(this).css({height:m.height()+"px",width:m.width()+"px"});a("div.fullsize-loading").remove();var y=a("<div></div>").addClass("fullsize-wrapper").css({display:"none","margin-top":K.top,"margin-left":K.left});a(y).prepend(this);if(k!=""||c.forceTitleBar==true){var J=a("<a></a>").addClass("fullsize-close");var x=a("<div></div>").addClass("fullsize-title").css({"max-width":img_w});var M=a("<div></div>").addClass("fullsize-title-text").text(k);a(x).prepend(J);a(x).prepend(M);a(y).prepend(x);a("body").prepend(y);if(C!=0){C=C-12}}else{a("body").prepend(y)}a(this).addClass("fullsize-close");if(c.shadow==true){if(a.browser.safari||(a.browser.mozilla&&a.browser.version.substr(0,5)>="1.9.1")){a(y).css({"-webkit-box-shadow":"0 2px 16px #000","-moz-box-shadow":"0 2px 16px #000","box-shadow":"0 2px 16px #000"})}else{var A=a("<div></div>").addClass("fullsize-sh-wrap").css({display:"none",width:m.width(),"margin-top":K.top,"margin-left":K.left});var z=a("<div></div>").addClass("fullsize-sh-top");var N=a("<div></div>").addClass("fullsize-sh-top-l");var L=a("<div></div>").addClass("fullsize-sh-top-m");var G=a("<div></div>").addClass("fullsize-sh-top-r");a(z).append(N).append(G).append(L);a(A).prepend(z);var D=a("<div></div>").addClass("fullsize-sh-body");var E=a("<div></div>").addClass("fullsize-sh-body-r");a(D).append(E);a(A).append(D);var I=a("<div></div>").addClass("fullsize-sh-bottom");var H=a("<div></div>").addClass("fullsize-sh-bottom-l");var O=a("<div></div>").addClass("fullsize-sh-bottom-m");var F=a("<div></div>").addClass("fullsize-sh-bottom-r");a(I).append(H).append(F).append(O);a(A).append(I);a("body").prepend(A);a(D).animate({height:parseInt(y.height())+img_h-22},{queue:false,duration:c.zoomInSpeed});a(A).fadeIn(c.fadeInSpeed).animate({height:parseInt(y.height())+img_h+22,width:img_w+22,marginTop:C-9,marginLeft:B-11},{queue:false,duration:c.zoomInSpeed})}}a(this).fadeIn(c.fadeInSpeed).animate({height:img_h,width:img_w},{queue:false,duration:c.zoomInSpeed});a(y).fadeIn(c.fadeInSpeed).animate({width:img_w,marginTop:C,marginLeft:B},{queue:false,duration:c.zoomInSpeed});a(".fullsize-close").click(function(){e(r,y,m,a(this))})}).attr("src",l).addClass("fullsize-image")});function e(p,i,s,r){var q=s.offset();a(p).fadeOut(c.fadeOutSpeed).animate({height:s.height(),width:s.width()},{queue:false,duration:c.zoomOutSpeed});if(c.shadow==true){a("div.fullsize-sh-wrap").remove()}a(i).fadeOut(c.fadeOutSpeed).animate({width:s.width(),marginTop:q.top,marginLeft:q.left},{queue:false,duration:c.zoomOutSpeed,complete:function(){r.remove()}});c.end.call(this)}}}})}})(jQuery);