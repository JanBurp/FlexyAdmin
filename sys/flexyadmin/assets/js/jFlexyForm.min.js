function doForm(){$(".flexyFormField.image_dragndrop").each(function(){selHeight=$(this).children("ul.choices").outerHeight();selHeight+=$(this).children("ul.values").outerHeight();$(this).css({height:selHeight+4})});if(typeof(formFieldWhen)!="undefined"){var a=$(".flexyFormField");$(a).each(function(){var f=$(this).attr("class");f=f.split(" ");f=f[2];if(typeof(formFieldWhen[f])!="undefined"){var e=formFieldWhen[f];$("#"+e.actor).change(function(){var g=$(this).val();$(".flexyFormField."+e.field).add("#"+f).addClass("hidden");switch(e.operator){case"=":if(g==e.value){$(".flexyFormField."+e.field).add("#"+f).removeClass("hidden")}break;case">":if(g>e.value){$(".flexyFormField."+e.field).add("#"+f).removeClass("hidden")}break;case"<":if(g<e.value){$(".flexyFormField."+e.field).add("#"+f).removeClass("hidden")}break}if(!$(".flexyFormField."+e.field).hasClass("hidden")){$(".flexyFormField."+e.field).css({"min-height":"27px"})}})}})}if(config.form_nice_dropdowns){$(".flexyFormField select:not(.multiple)").multiselect({header:false,multiple:false,selectedList:4,height:"auto"}).bind("multiselectclick",function(f,g){if($(f.target).hasClass("image_dropdown")){var e=$(f.target).multiselect("getChecked").map(function(){return this.value}).get();d(f.target,e)}});$(".flexyFormField select.multiple:not(.image_dropdown)").multiselect({header:false,selectedList:4,height:"auto",noneSelectedText:""});$(".flexyFormField select.multiple.image_dropdown").multiselect({header:false,height:"auto",minWidth:"auto",selectedList:false,selectedText:"",noneSelectedText:""}).bind("multiselectclick",function(j,k){var h=k.checked;var l=k.text;var e=$(j.target).parents("div.ui-multiselect-menu").find('input[title="'+l+'"]');e.attr("checked",h);var g=$(j.target).multiselect("getChecked").map(function(){return this.value}).get();var f=new Array();for(i=0;i<g.length;i++){if($.inArray(g[i],f)==-1){f.push(g[i])}}d(j.target,f)});$(".flexyFormField.image_dropdown.multiple ul.values").css({width:425,"float":"left",position:"relative"});$(".flexyFormField.image_dropdown.multiple button.ui-multiselect").css({width:460,height:38,"float":"right","margin-top":-42});$(".flexyFormField.dropdown button").css({width:460})}$("form input.datetime").each(function(){var g=$(this).attr("value");var l=$(this).attr("class");var k=$(this).attr("id");var f=k+"__date";var j=k+"__time";g=g.split(" ");var e=g[0];var h=g[1];$(this).after('<input id="'+j+'" name="'+j+'" class="'+l+' time" value="'+h+'">');$(this).after('<input id="'+f+'" name="'+f+'" class="'+l+' date" value="'+e+'">');$(this).hide();$("#"+f).add("#"+j).change(function(){g=$("#"+f).val()+" "+$("#"+j).val();$("#"+k).attr("value",g)})});$("form input.date").datepicker({dateFormat:"yy-mm-dd"});$("form input.time").timepicker({hourCols:6,minDivision:5,hourCaption:lang("ui-timepicker-choose-hours"),minuteCaption:lang("ui-timepicker-choose-minutes"),closeOnFormclick:true});$("form input.rgb").each(function(){var e=$(this).val();$(this).after('<div class="rgbColor" style="background-color:'+e+';" color="'+e+'"></div>');$(this).change(function(){var f=$(this).next(".rgbColor");var g=$(this).val();$(f).css({"background-color":g}).attr("color",g)});$(this).next(".rgbColor").click(function(){var f=$(this);$(this).ColorPicker({onBeforeShow:function(){var g=$(this).attr("color");$(this).ColorPickerSetColor(g)},onSubmit:function(g,l,j,k){var h="#"+l.toUpperCase();$(k).css({"background-color":h}).attr("color",h).prev("input.rgb:first").val(h);$(k).ColorPickerHide()},onChange:function(g,k,j){var h="#"+k.toUpperCase();$(f).css({"background-color":h}).prev("input.rgb:first").val(h)}})}).trigger("click")});$("form input.password:not(.matches)").after('<span class="button">'+lang("form_random_password")+"</span>");$("form span.button").click(function(){pwd=randomPassword(10);$(this).prev("input.password").attr("value",pwd)});$("div.image_dropdown select.medias optgroup:first option:selected").attr("selected","");var c=$("div.image_dropdown");$(c).each(function(){var g=$(this);var e=$(g).find("select");var f=$(e).find("option");if(f.length>0){$(e).change(function(){d(e)})}});function d(l,n){var j=$(l).prevAll("ul.values");var q=$(l).find("option");var r=$(l).hasClass("medias");var p=$(l).attr("path")+"/";$(j).find("li").remove();if(r){$(l).prevAll("input").attr("value","")}if(typeof(n)=="undefined"){var k=$(l).find("option:selected");var f=new Array;var n=new Array;$(k).each(function(){f.push($(this).attr("value"))});for(h=0;h<f.length;h++){if($.inArray(f[h],n)==-1){n.push(f[h])}}}var m="";for(var h=0;h<n.length;h++){var e=n[h];if(r&&m!=""){m=m+"|"+e}else{m=e}e=p+e;var g=get_ext(e);var o=32;if(r){o=25}if(g=="swf"||g=="flv"){$(j).append("<li>"+flash(e,o,o)+"</li>")}else{e=cachedThumb(e);$(j).append('<li><img class="media" src="'+e+'" /></li>')}}$(l).prevAll("input").attr("value",m)}$("div.media ul.choices").add("div.medias ul.choices").add("div.medias ul.values").click(function(k){var j=k.target;var g="media";if($(j).parents("div:first").hasClass("medias")){g="medias"}var m=$(j).attr("src");if(g=="media"){var l=pathdecode(m);l=l.substr(l.lastIndexOf("/")+1);$(j).parents("div.media").children("ul.values").empty();$(j).parents("div.media").children("ul.values").append('<li><img class="zoom" src="'+m+'" alt="'+l+'" title="'+l+'" /></li>');$(j).parents("div.media").children("input:first").attr("value",l)}else{var h=$(j).parent("li:first").clone(true);var f=$(j).parents("div.medias").children("ul.values");if($(j).parents("ul:first").hasClass("choices")){$(j).parents("div.medias").children("ul.values").append(h)}else{$(j).parents("div.medias").children("ul.choices").append(h)}$(j).parent("li:first").remove();$(".zoomThumb").hide();b($(f))}});$("div.media ul.values").click(function(){$(this).empty();$(this).parent("div.media").children("input:first").attr("value","")});function b(f){if($(f).hasClass("values")){var e="";$(f).children("li").each(function(){var g=$(this).children("img:first").attr("src");if(g!=undefined){g=pathdecode(g);g=g.substr(g.lastIndexOf("/")+1);e+="|"+g}});e=e.substr(1);$(f).parent(".flexyFormField:first").children("input:first").attr("value",e)}}$("div.medias ul").sortable({connectWith:"div.medias ul",update:function(e,f){b($(this))}});$("form").submit(function(){$("form .image_dragndrop input").each(function(){var e=$(this).attr("value");if(e=="flexyadmin_empty_image.gif"){$(this).attr("value","")}})});$("div.ordered_list ul").sortable({connectWith:"div.ordered_list ul",update:function(e,f){if($(this).hasClass("list_values")){value="";$(this).children("li").each(function(){id=$(this).attr("id");value+="|"+id});value=value.substr(1);$(this).parent(".flexyFormField").children("input:first").attr("value",value)}}})};