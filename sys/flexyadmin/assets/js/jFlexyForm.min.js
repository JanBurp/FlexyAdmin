function doForm(){(function(f){f.prevent_leaving_unsaved_page=function(g){var h=true;f("input").add("textarea").change(function(){h=false});f("form").submit(function(){h=true});f(window).bind("beforeunload",function(){if(!h){return lang("dialog_beforeunload")}})}})(jQuery);$.prevent_leaving_unsaved_page();if(typeof(formFieldWhen)!="undefined"){var a=$(".flexyFormField");$(a).each(function(){var g=$(this).attr("class");g=g.split(" ");g=g[2];if(typeof(formFieldWhen[g])!="undefined"){var f=formFieldWhen[g];$("#"+f.actor).change(function(){var h=$(this).val();$(".flexyFormField."+f.field).add("#"+g).addClass("hidden");switch(f.operator){case"=":if(h==f.value){$(".flexyFormField."+f.field).add("#"+g).removeClass("hidden")}break;case">":if(h>f.value){$(".flexyFormField."+f.field).add("#"+g).removeClass("hidden")}break;case"<":if(h<f.value){$(".flexyFormField."+f.field).add("#"+g).removeClass("hidden")}break}if(!$(".flexyFormField."+f.field).hasClass("hidden")){$(".flexyFormField."+f.field).css({"min-height":"27px"})}})}})}if(config.form_nice_dropdowns){$.ech.multiselect.prototype.options={header:false,height:"auto",minWidth:"auto",selectedList:2,noneSelectedText:"-",selectedText:"",multiple:true};$(".flexyFormField select:not(.multiple)").multiselect({multiple:false,click:function(g,h){if($(g.target).hasClass("image_dropdown")){var f=$(g.target).multiselect("getChecked").map(function(){return this.value}).get();e(g.target,f)}}});$(".flexyFormField select.multiple.dropdown").multiselect({create:function(f,g){b(f.target)},click:function(h,j){var g=j.checked;var k=j.text;var f=$(h.target).parent(".flexyFormField").find('input[title="'+k+'"]');f.attr("checked",g)},beforeclose:function(f,g){b(f.target)}});$(".flexyFormField select.multiple.image_dropdown").multiselect({selectedList:false,selectedText:"",click:function(j,k){var h=k.checked;var l=k.text;var f=$(j.target).parent(".flexyFormField").find('input[title="'+l+'"]');f.attr("checked",h);var g=$(j.target).multiselect("getChecked").map(function(){return this.value}).get();e(j.target,g)}});$(".flexyFormField.dropdown button").css({width:460});$(".flexyFormField.dropdown.rel button").css({width:430});$(".flexyFormField.dropdown .ui-multiselect-menu").css({width:458});$(".flexyFormField.dropdown.has_button button").css({width:430});$(".flexyFormField.dropdown.has_button .ui-multiselect-menu").css({width:428});$(".flexyFormField.image_dropdown.multiple ul.values").css({width:425,position:"relative"});$(".flexyFormField.image_dropdown button.ui-multiselect").css({width:420,height:38,"float":"right","margin-top":-42})}$("form input.datetime").each(function(){var h=$(this).attr("value");var m=$(this).attr("class");var l=$(this).attr("id");var g=l+"__date";var k=l+"__time";h=h.split(" ");var f=h[0];var j=h[1];$(this).after('<input id="'+k+'" name="'+k+'" class="'+m+' time" value="'+j+'">');$(this).after('<input id="'+g+'" name="'+g+'" class="'+m+' date" value="'+f+'">');$(this).hide();$("#"+g).add("#"+k).change(function(){h=$("#"+g).val()+" "+$("#"+k).val();$("#"+l).attr("value",h)})});$("form input.date").datepicker({dateFormat:"yy-mm-dd"});$("form input.time").timepicker({hourCols:6,minDivision:5,hourCaption:lang("ui-timepicker-choose-hours"),minuteCaption:lang("ui-timepicker-choose-minutes"),closeOnFormclick:true});$("form input.rgb").each(function(){var f=$(this).val();$(this).after('<div class="rgbColor" style="background-color:'+f+';" color="'+f+'"></div>');$(this).change(function(){var g=$(this).next(".rgbColor");var h=$(this).val();$(g).css({"background-color":h}).attr("color",h)});$(this).next(".rgbColor").click(function(){var g=$(this);$(this).ColorPicker({onBeforeShow:function(){var h=$(this).attr("color");$(this).ColorPickerSetColor(h)},onSubmit:function(h,m,k,l){var j="#"+m.toUpperCase();$(l).css({"background-color":j}).attr("color",j).prev("input.rgb:first").val(j);$(l).ColorPickerHide()},onChange:function(h,l,k){var j="#"+l.toUpperCase();$(g).css({"background-color":j}).prev("input.rgb:first").val(j)}})}).trigger("click")});$("form input.password:not(.matches)").after('<span class="button">'+lang("form_random_password")+"</span>");$("form span.button").click(function(){pwd=randomPassword(10);$(this).prev("input.password").attr("value",pwd)});var d=$("div.image_dropdown");$(d).each(function(){var h=$(this);var f=$(h).find("select");var g=$(f).find("option");if(g.length>0){$(f).change(function(){e(f)})}});function b(g){var j=$(g).multiselect("getChecked").map(function(){return this.value}).get();var h=new Array();for(i=0;i<j.length;i++){if($.inArray(j[i],h)==-1){h.push(j[i])}}var f="";$(h).each(function(){f+=" | "+this});f=f.substr(3);var k=$(g).parent(".flexyFormField").find("button span:not(.ui-icon)");$(k).html(f)}function e(m,o){var k=$(m).prevAll("ul.values");var r=$(m).find("option");var s=$(m).hasClass("medias");var q=$(m).attr("path")+"/";$(k).find("li").remove();if(s){$(m).prevAll("input").attr("value","")}if(typeof(o)=="undefined"){var l=$(m).find("option:selected");var g=new Array;var o=new Array;$(l).each(function(){g.push($(this).attr("value"))});for(j=0;j<g.length;j++){if($.inArray(g[j],o)==-1){o.push(g[j])}}}var n="";for(var j=0;j<o.length;j++){var f=o[j];if(s&&n!=""){n=n+"|"+f}else{n=f}f=q+f;var h=get_ext(f);var p=32;if(s){p=25}if(h=="swf"||h=="flv"){$(k).append("<li>"+flash(f,p,p)+"</li>")}else{f=cachedThumb(f);$(k).append('<li><img class="media" src="'+f+'" /></li>')}}$(m).prevAll("input").attr("value",n)}$("div.media ul.choices").add("div.medias ul.choices").add("div.medias ul.values").click(function(k){var j=k.target;var g="media";if($(j).parents("div:first").hasClass("medias")){g="medias"}var m=$(j).attr("src");if(g=="media"){var l=pathdecode(m);l=l.substr(l.lastIndexOf("/")+1);$(j).parents("div.media").children("ul.values").empty();$(j).parents("div.media").children("ul.values").append('<li><img class="zoom" src="'+m+'" alt="'+l+'" title="'+l+'" /></li>');$(j).parents("div.media").children("input:first").attr("value",l)}else{var h=$(j).parent("li:first").clone(true);var f=$(j).parents("div.medias").children("ul.values");if($(j).parents("ul:first").hasClass("choices")){$(j).parents("div.medias").children("ul.values").append(h)}else{$(j).parents("div.medias").children("ul.choices").append(h)}$(j).parent("li:first").remove();$(".zoomThumb").hide();c($(f))}});$("div.media ul.values").click(function(){$(this).empty();$(this).parent("div.media").children("input:first").attr("value","")});function c(g){if($(g).hasClass("values")){var f="";$(g).children("li").each(function(){var h=$(this).children("img:first").attr("src");if(h!=undefined){h=pathdecode(h);h=h.substr(h.lastIndexOf("/")+1);f+="|"+h}});f=f.substr(1);$(g).parent(".flexyFormField:first").children("input:first").attr("value",f)}}$("div.medias ul").sortable({connectWith:"div.medias ul",update:function(f,g){c($(this))}});$("form").submit(function(){$("form .image_dragndrop input").each(function(){var f=$(this).attr("value");if(f=="flexyadmin_empty_image.gif"){$(this).attr("value","")}})});$("div.ordered_list ul").sortable({connectWith:"div.ordered_list ul",update:function(f,g){if($(this).hasClass("list_values")){value="";$(this).children("li").each(function(){id=$(this).attr("id");value+="|"+id});value=value.substr(1);$(this).parent(".flexyFormField").children("input:first").attr("value",value)}}})};